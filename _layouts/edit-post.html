---
layout: page
---

{{ content }}

<section class="content-container">
    <div class="container">   
        <div class="editor-container">
            <form id = "form-updatepost" class="" method="post" action="/api/UpdatePost">
                <div>
                    <label class="label-title">
                        <input id="updatedTitle" type="text" class="" name="title" placeholder="Enter a title" tabindex="1" required />
                        <span class="required">Title</span>
                    </label>
                </div>
                <div>
                    <label class="label-categories">
                        <input id="updatedCategories" type="text" class="" name="categories" placeholder="Enter categories" tabindex="2" required />
                        <span class="required">Categories</span>
                    </label>
                </div>
                <div>
                    <label class="label-tags">
                        <input id="updatedTags" type="text" class="" name="tags" placeholder="Enter tags" tabindex="3" required />
                        <span class="required">Tags</span>
                    </label>
                </div>
                <div>
                    <label class="label-content">  
                        <span class="required">Content</span>
                    </label>
                    <!-- Create the editor container -->
                    <div id="updateEditor">        
                    </div>
                </div> 
                <div>
                    <button id="updatepost-button" class="btn btn-demo" type="submit">Update</button>          
                </div> 
            </form>
        </div>
        <div id="review-container">
        </div>   
    </div>
</section>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js">
    hljs.configure({
        languages: ['javascript', 'ruby', 'python']
    });
</script>
<!-- Include the higlight.js library -->
<link rel="stylesheet"
href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
<!-- Include the Quill library -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<!-- Include stylesheet, Need to move to centralised location -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">  

<style>
    .ql-editor {
        min-height: 300px;
    }

    form, .preview-container {
        --background: white;
        --border: rgba(0, 0, 0, 0.125);
        --borderDark: rgba(0, 0, 0, 0.25);
        --borderDarker: rgba(0, 0, 0, 0.5);
        --bgColorH: 0;
        --bgColorS: 0%;
        --bgColorL: 98%;
        --fgColorH: 210;
        --fgColorS: 50%;
        --fgColorL: 38%;
        --shadeDark: 0.3;
        --shadeLight: 0.7;
        --shadeNormal: 0.5;
        --borderRadius: 0.125rem;
        --highlight: #306090;
        background: white;
        border: 1px solid var(--border);
        border-radius: var(--borderRadius);
        box-shadow: 0 1rem 1rem -0.75rem var(--border);
        display: flex;
        flex-direction: column;
        padding: 1rem;
        position: relative;
        overflow: hidden;
        }

        form a:focus {
        color: hsl(var(--fgColorH), var(--fgColorS), calc(var(--fgColorL) * 0.85));
        outline: 1px dashed hsl(var(--fgColorH), calc(var(--fgColorS) * 2), calc(var(--fgColorL) * 1.15));
        outline-offset: 2px;
        }

        form > div {
        order: 2;
        }

        label {
        display: flex;
        flex-direction: column;
        }

        label > span {
        color: var(--borderDarker);
        display: block;
        font-size: 0.825rem;
        margin-top: 0.625rem;
        order: 1;
        transition: all 0.25s;
        }

        label > span.required::after {
        content: "*";
        color: #dd6666;
        margin-left: 0.125rem;
        }

        label input {
        order: 2;
        outline: none;
        }

        label input::placeholder {
        color: var(--borderDark);
        }

        input.text:focus + span,
        input.text:active + span {
        color:  hsl(var(--fgColorH), calc(var(--fgColorS) * 2), calc(var(--fgColorL) * 1.15));
        }

        input {
        border: 1px solid var(--border);
        border-radius: var(--borderRadius);
        box-sizing: border-box;
        font-size: 1rem;
        height: 2.25rem;
        line-height: 1.25rem;
        margin-top: 0.25rem;
        order: 2;
        padding: 0.25rem 0.5rem;
        width: 15rem;
        transition: all 0.25s;
        }

        button[type="submit"] {
        color: hsl(var(--bgColorH), var(--bgColorS), var(--bgColorL));
        background: hsl(var(--fgColorH), var(--fgColorS), var(--fgColorL));
        font-size: 0.75rem;
        font-weight: bold;
        margin-top: 0.625rem;
        order: 4;
        outline: 1px dashed transparent;
        outline-offset: 2px;
        padding-left: 0;
        text-transform: uppercase;
        }
</style>

<!-- Initialize Quill editor -->    
<script>        

    var toolbarOptions1 = [
         ['bold', 'italic', 'underline', 'strike'],        // toggled buttons
         ['blockquote', 'code-block'],

         [{ 'header': 1 }, { 'header': 2 }],               // custom button values
         [{ 'list': 'ordered'}, { 'list': 'bullet' }],
         [{ 'script': 'sub'}, { 'script': 'super' }],      // superscript/subscript
         [{ 'indent': '-1'}, { 'indent': '+1' }],          // outdent/indent
         [{ 'direction': 'rtl' }],                         // text direction

         [{ 'size': ['small', false, 'large', 'huge'] }],  // custom dropdown
         [{ 'header': [1, 2, 3, 4, 5, 6, false] }],            

         [{ 'color': [] }, { 'background': [] }],          // dropdown with defaults from theme
         [{ 'font': [] }],
         [{ 'align': [] }],     
         
         [ 'link', 'image', 'formula' ],                   // add image support

         ['clean']                                         // remove formatting button
     ];

     var uquill = new Quill('#updateEditor', {
         theme: 'snow',
         modules: {                           
             toolbar: toolbarOptions1,
             syntax: true, //Allows syntax highlighting           
         }
     });

     const editor = document.getElementById("updateEditor");
     const titleInput = document.getElementById("updatedTitle");   
     
</script>

<script>
    //Get file path from query string
    const params = new Proxy(new URLSearchParams(window.location.search), {
        get: (queryParams, prop) => queryParams.get(prop),
    });
    
    var filePath = params.filePath;
    console.log('Query param: ' + filePath);
    
    //Call api/GetPost to retrieve content of existing post
    var gurl = "/api/GetPost?filePath=" + filePath;
    console.log('url: ' + gurl);

    const gfetchOptions = {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
			              "Accept": "application/json"
                },              
            };
    fetch(gurl, gfetchOptions)
                  .then(response => response.json())
                  .then(data => {
                      if (data) {
                        console.log('Response:' + data);
                                          
                        var quillContainer = editor.getElementsByClassName('ql-editor');
                        quillContainer[0].innerHTML = data;

                        titleInput.innerText = "Update Title";
                      } else {
                        console.log("Error occrred on api call");
                      }
                  });
     console.log('api/GetPost call complete!');

    //Go to Edit post page and populate the retrieved data  
    async function postUpdateFormDataAsJson ( {update_url, updateFormData }){
            const plainFormData = Object.fromEntries(updateFormData.entries());
            const formDataJsonString = JSON.stringify(plainFormData);

            console.log(formDataJsonString);
            console.log(plainFormData);

            const ufetchOptions = {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
			        "Accept": "application/json"
                },
                body: formDataJsonString
            };

            const response = await fetch(update_url, ufetchOptions);

            if(!response.ok){
                const errorMessage = await response.text();
                throw new Error(errorMessage);
            }

            return response.json();
        }

        async function handleFormUpdate(event){
            console.log("update form submit is clicked!");
            event.preventDefault();

            const f = event.currentTarget;
            const update_url = f.action;

            try
            {
                const updateFormData = new FormData(f);

                var utitle = document.getElementById("updatedTitle").value;
                var ucategories = document.getElementById("updatedCategories").value;
                var utags = document.getElementById("updatedTags").value;
                var ubody = uquill.root.innerHTML;

                updateFormData.append("title", utitle);
                updateFormData.append("categories", ucategories);
                updateFormData.append("tags", utags);
                updateFormData.append("body", ubody);

                const responseData = await postUpdateFormDataAsJson({ update_url, updateFormData });
                console.log( { responseData });

                const reviewContainer = document.getElementById("review-container");  
                
                const goToPostsLink = document.createElement("a");
                goToPostsLink.innerText = "Go to Posts to view updated post.";               
                goToPostsLink.href = "/posts/";                
                
                reviewContainer.innerHTML = responseData;     
                reviewContainer.appendChild(goToPostsLink);          

            }
            catch(error){
                console.error(error);
            }
        }
            
        const uform = document.getElementById("form-updatepost");
        uform.addEventListener("submit", handleFormUpdate);  

    //Populate this content in the editor

    //Save the content


</script>